# CFB Team 360 - Design Document

**Status:** Approved
**Author:** Rob (Head of Technology)
**Date:** January 29, 2026

---

## Overview

**Product:** CFB Team 360 — an interactive portal for exploring college football team analytics.

**Core concept:** Search or browse to any FBS team. Land on a comprehensive dashboard showing who they are, how they play, and how they've evolved — anchored by a unique drive patterns visualization.

**Target users:**
- CFB fans wanting deeper insights than ESPN provides
- Analysts and media professionals needing quick team research
- Bettors looking for style matchup edges

**Tech stack:**
- **Frontend:** Next.js 14 (App Router) + React + TypeScript
- **Visualization:** D3.js for custom football field graphics
- **Data:** Supabase Postgres (existing warehouse)
- **Hosting:** Vercel

**MVP scope:**
- Team search/browse
- Core metrics (EPA, success rate, rankings)
- Style profile (run/pass, tempo, identity)
- Historical trajectory (year-over-year, era context)
- Hero visualization: Drive patterns

**Future iterations:**
- Situational splits (by down, distance, field position)
- Matchup history (head-to-head records)
- Player leaders (top EPA contributors)
- Additional field visualizations (tendency heatmaps, red zone efficiency)

---

## Dashboard Layout

**URL structure:** `/teams/[team-slug]` (e.g., `/teams/texas`, `/teams/ohio-state`)

### Header
- Team logo (with alt text), name (h1), conference, current record
- Season selector: native `<select>` or Radix Select for full keyboard support
- Era badge: min 44x44px tap target, 4.5:1 contrast

### Hero: Drive Patterns Visualization
- Full-width football field (SVG, ~400px tall)
- `aria-label` on SVG describing the visualization
- Drive arcs color-coded + patterned:
  - Solid green = Touchdown
  - Dashed blue = Field Goal
  - Dotted gray = Punt
  - Red with x-marks = Turnover
- Legend with text labels (not color-only)
- Click/focus to reveal drive details (not hover-only)
- Toggle: offense vs defense (keyboard accessible)
- **Data table alternative:** Expandable "View as table" for screen readers

### Metrics Cards Row
- 4 cards: EPA per Play, Success Rate, Explosiveness, Tempo
- Each shows value + national rank + trend vs last season
- Responsive: 4-col desktop → 2x2 tablet → stack mobile
- Trend arrows include text label ("up 5 spots")

### Style Profile Panel (h2)
- Run/pass donut chart with percentage labels (not color-only)
- Offensive identity badge with text (run-heavy / balanced / pass-heavy)
- Strength callouts as text, not just icons

### Historical Trajectory Chart (h2)
- Line chart: EPA per play over seasons (2004-present)
- Era backgrounds with pattern fills (not color-only)
- Click/focus on data points for details (not hover-only)
- Screen reader: summary text + data table toggle

### Heading Hierarchy
- h1: Team name
- h2: Section titles (Drive Patterns, Style Profile, Trajectory)
- h3: Subsections as needed

---

## Accessibility Requirements (from Rams Review)

| Issue | Severity | Solution |
|-------|----------|----------|
| SVG without text alternative | Critical | aria-label + data table toggle |
| Color-only drive outcomes | Critical | Patterns + icons alongside colors |
| Hover-only interactions | Serious | Support focus + click, not just hover |
| Custom dropdown a11y | Serious | Use Radix Select or native `<select>` |
| Small touch targets | Serious | Min 44x44px for interactive elements |
| Heading hierarchy | Moderate | Plan h1 → h2 → h3 structure |
| Mobile card layout | Moderate | 2x2 grid or horizontal scroll |

---

## Data Flow & API

**Connection:** Supabase JS client from Next.js server components

### Queries by Section

| Section | Mart/Table | Query |
|---------|------------|-------|
| Header | `ref.teams`, `core.games` | Team info + current season record |
| Drive Patterns | `core.drives` | Aggregate via `get_drive_patterns()` RPC |
| Metrics Cards | `marts.team_season_epa` | Single row for team + season |
| Style Profile | `marts.team_style_profile` | Single row for team + season |
| Trajectory | `marts.team_season_trajectory` | All rows for team, all seasons |

### Data Fetching Pattern

```typescript
// app/teams/[slug]/page.tsx (Server Component)
export default async function TeamPage({ params }) {
  const supabase = createServerClient()

  const [team, metrics, style, trajectory, drives] = await Promise.all([
    supabase.from('teams').select('*').eq('slug', params.slug).single(),
    supabase.from('team_season_epa').select('*').eq('team', teamName).eq('season', 2024),
    supabase.from('team_style_profile').select('*').eq('team', teamName).eq('season', 2024),
    supabase.from('team_season_trajectory').select('*').eq('team', teamName).order('season'),
    supabase.rpc('get_drive_patterns', { team_name: teamName, season: 2024 })
  ])

  return <TeamDashboard data={{ team, metrics, style, trajectory, drives }} />
}
```

### New Database Function Required

```sql
-- get_drive_patterns(team, season)
-- Returns: start_yard, end_yard, outcome, count, avg_plays, avg_yards
```

---

## Drive Patterns Visualization

**The hero feature.**

### Visual Concept
- Football field rendered as SVG (100 yards, end zones, yard lines, hash marks)
- Each drive represented as an arc from start to end yard line
- Arc height indicates drive length (longer drives = taller arcs)
- Arcs grouped by outcome with distinct visual treatment

### Arc Styling

| Outcome | Color | Pattern | Opacity |
|---------|-------|---------|---------|
| Touchdown | Green (#22c55e) | Solid | 80% |
| Field Goal | Blue (#3b82f6) | Dashed | 70% |
| Punt | Gray (#6b7280) | Dotted | 50% |
| Turnover | Red (#ef4444) | X-marks at end | 70% |

### Interactivity
- Click/focus on arc cluster → tooltip with stats
- Toggle button: "Our Drives" / "Opponent Drives"
- Season selector syncs with header dropdown
- "View as table" button → accessible data table overlay

### D3 Structure

```svg
<svg viewBox="0 0 1000 400">
  <g class="field">        <!-- yard lines, hash marks, end zones -->
  <g class="arcs">         <!-- drive arc paths, grouped by outcome -->
  <g class="legend">       <!-- outcome legend with patterns -->
  <g class="tooltip">      <!-- positioned on focus/click -->
</svg>
```

### Data Shape

```typescript
interface DrivePattern {
  start_yard: number    // e.g., 25 (own 25)
  end_yard: number      // e.g., 100 (opponent end zone)
  outcome: 'touchdown' | 'field_goal' | 'punt' | 'turnover'
  count: number         // drives matching this pattern
  avg_plays: number
  avg_yards: number
}
```

---

## Project Structure

```
cfb-team-360/
├── app/
│   ├── layout.tsx              # Root layout, fonts, metadata
│   ├── page.tsx                # Home: team search/browse
│   ├── teams/
│   │   └── [slug]/
│   │       └── page.tsx        # Team 360 dashboard
│   └── api/                    # API routes if needed later
├── components/
│   ├── ui/                     # Reusable primitives (Button, Card, Select)
│   ├── team/
│   │   ├── TeamHeader.tsx
│   │   ├── MetricsCards.tsx
│   │   ├── StyleProfile.tsx
│   │   └── TrajectoryChart.tsx
│   └── visualizations/
│       ├── FootballField.tsx   # Base SVG field component
│       ├── DrivePatterns.tsx   # Hero visualization
│       └── DriveTable.tsx      # Accessible data table alternative
├── lib/
│   ├── supabase/
│   │   ├── client.ts           # Browser client
│   │   └── server.ts           # Server client
│   └── utils.ts                # Helpers, formatters
├── styles/
│   └── globals.css             # Tailwind + custom properties
└── public/
    └── logos/                  # Team logos (if self-hosted)
```

### Key Dependencies

- `next` (14.x, App Router)
- `@supabase/supabase-js`
- `d3`
- `tailwindcss`
- `@radix-ui/react-select`

---

## MVP Milestones

1. Project setup + Supabase connection
2. Team list/search page
3. Basic Team 360 layout (no viz)
4. Drive Patterns visualization
5. Polish + deploy to Vercel

---

## Future Iterations

**v1.1 — Additional Data Panels:**
- Situational splits (down, distance, field position)
- Matchup history (head-to-head records vs rivals)
- Player leaders (top EPA contributors)

**v1.2 — Additional Visualizations:**
- Field position efficiency heatmap
- Play tendency overlay
- Scoring opportunities (red zone)

**v2 — Expanded Features:**
- Matchup analysis tool (pick two teams)
- Game predictions with edge breakdown
- Leaderboards / rankings browser
